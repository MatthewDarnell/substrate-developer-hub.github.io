<!DOCTYPE html><html lang="zh-CN"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>把模块写到自己的包内 · Substrate Developer Hub</title><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="generator" content="Docusaurus"/><meta name="description" content="在这个教程中，您会在自己 crate 中编写一个 Substrate 模块， 并把他引入到基于 `substrate-node-template` 构建的节点中。"/><meta name="docsearch:language" content="zh-CN"/><meta property="og:title" content="把模块写到自己的包内 · Substrate Developer Hub"/><meta property="og:type" content="website"/><meta property="og:url" content="https://substrate-developer-hub.github.io//"/><meta property="og:description" content="在这个教程中，您会在自己 crate 中编写一个 Substrate 模块， 并把他引入到基于 `substrate-node-template` 构建的节点中。"/><meta property="og:image" content="https://substrate-developer-hub.github.io/img/substrate-dev-hub-card.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://substrate-developer-hub.github.io/img/substrate-dev-hub-card.png"/><link rel="shortcut icon" href="/img/favicon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script><script type="text/javascript" src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script><script type="text/javascript" src="/js/clipboard.min.js"></script><script type="text/javascript" src="/js/code-block-buttons.js"></script><script type="text/javascript" src="/js/load.js"></script><script type="text/javascript" src="/js/past-seminars.js"></script><script type="text/javascript" src="/js/config.js" defer=""></script><script type="text/javascript" src="/js/klaro.min.js" defer=""></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/prism.css"/><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/zh-CN"><img class="logo" src="/img/Substrate-logo.svg" alt="Substrate Developer Hub"/><h2 class="headerTitleWithLogo">Substrate Developer Hub</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/zh-CN/tutorials" target="_self">教程</a></li><li class=""><a href="/docs/zh-CN/" target="_self">知识库</a></li><li class=""><a href="https://substrate.dev/recipes/" target="_self">进阶菜谱</a></li><li class=""><a href="https://substrate.dev/substrate-how-to-guides/" target="_self">How-to Guides</a></li><li class=""><a href="https://substrate.dev/rustdocs/" target="_self">Reference</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li><span><li><a id="languages-menu" href="#"><img class="languages-icon" src="/img/language.svg" alt="Languages icon"/>简体中文</a><div id="languages-dropdown" class="hide"><ul id="languages-dropdown-items"><li><a href="/docs/en/tutorials/create-a-pallet">English</a></li><li><a href="https://crowdin.com/project/substrate-developer-hub" target="_blank" rel="noreferrer noopener">协助翻译</a></li></ul></div></li><script>
        const languagesMenuItem = document.getElementById("languages-menu");
        const languagesDropDown = document.getElementById("languages-dropdown");
        languagesMenuItem.addEventListener("click", function(event) {
          event.preventDefault();

          if (languagesDropDown.className == "hide") {
            languagesDropDown.className = "visible";
          } else {
            languagesDropDown.className = "hide";
          }
        });
      </script></span></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://crowdin.com/project/substrate-developer-hub/zh-CN" target="_blank" rel="noreferrer noopener">Translate</a><h1 id="__docusaurus" class="postHeaderTitle">把模块写到自己的包内</h1></header><article><div><span><p>在这个教程中，您会在自己 crate 中编写一个 Substrate 模块， 并把他引入到基于 <code>substrate-node-template</code> 构建的节点中。</p>
<h2><a class="anchor" aria-hidden="true" id="安装-node-template"></a><a href="#安装-node-template" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>安装 Node Template</h2>
<p>You should already have version <code>v3.0.0</code> of the <a href="https://github.com/substrate-developer-hub/substrate-node-template">Substrate Node Template</a> compiled on your computer from when you completed the <a href="../create-your-first-substrate-chain/">Create Your First Substrate Chain Tutorial</a>. 如果您尚未完成该教程，请先完成它。</p>
<blockquote>
<p>有经验的开发者可以跳过该教程，您可以参考 readme 里的步骤说明。</p>
</blockquote>
<h3><a class="anchor" aria-hidden="true" id="starting-with-the-pallet-template"></a><a href="#starting-with-the-pallet-template" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Starting with the Pallet Template</h3>
<p>我们不会直接在节点模板中创建模块，而是创建单独的 Rust crate 。 这样我们可以分离节点和模块，从而单独发布创建的模块，这样也方便其他开发者将此模块引入到他们自己的 Substrate runtime 中。 There are two ways to go about this:</p>
<h3><a class="anchor" aria-hidden="true" id="option-1-use-this-template-from-github"></a><a href="#option-1-use-this-template-from-github" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Option 1: <code>Use This Template</code> from Github</h3>
<p>On the <a href="https://github.com/substrate-developer-hub/substrate-pallet-template">template page</a> you will see a big green button that invites you to <code>Use This Template</code> - clicking this will open up a dialog similar to a fork, but will start you with a base repository that is close with only the code from the template in your new repo.</p>
<p>Clone this new repo you own locally <strong>inside the node template <code>/pallets</code> directory</strong></p>
<pre><code class="hljs css language-bash"><span class="hljs-built_in">cd</span> pallets
git <span class="hljs-built_in">clone</span> &lt;your new pallet repo&gt; &lt;pallet directory name&gt;
<span class="hljs-comment"># example:</span>
<span class="hljs-comment"># git clone git@github.com:substrate-developer-hub/substrate-pallet-template.git test-pallet</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="option-2--clone-a-copy-of-the-template"></a><a href="#option-2--clone-a-copy-of-the-template" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Option 2:  Clone a copy of the Template</h3>
<p>Clone the Substrate pallet template in the <code>pallets</code> directory of your node template:</p>
<pre><code class="hljs css language-bash"><span class="hljs-built_in">cd</span> pallets
git <span class="hljs-built_in">clone</span> -b v3.0.0 --depth 1 https://github.com/substrate-developer-hub/substrate-pallet-template <span class="hljs-built_in">test</span>-pallet
</code></pre>
<blockquote>
<p>本教程中，我们把已经把模块模板放在了节点模板 <em>目录下</em>。 这种方式不是强制性的，您也可以将模块放置在你喜欢的任何地方。 比如，另一个常见的做法是把是它放在节点模板的 <em>同级目录</em>。</p>
</blockquote>
<h2><a class="anchor" aria-hidden="true" id="substrate-模块模板"></a><a href="#substrate-模块模板" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Substrate 模块模板</h2>
<p>Let's explore the Substrate pallet template, starting with the <code>Cargo.toml</code> file.</p>
<h3><a class="anchor" aria-hidden="true" id="renaming-your-crate"></a><a href="#renaming-your-crate" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Renaming Your Crate</h3>
<p>In the <code>Cargo.toml</code> file, you must update the crate's name. In this tutorial, we're focusing on how to create and use the pallet rather than writing interesting pallet logic. So let's update the value of the <code>package.name</code> attribute in the <code>Cargo.toml</code> file to <code>test-pallet</code>.</p>
<p>The <code>package</code> section of the <code>Cargo.toml</code> file now looks like:</p>
<p><strong><code>pallets/test-pallet/Cargo.toml</code></strong></p>
<pre><code class="hljs css language-toml"><span class="token punctuation">[</span><span class="token table class-name">package</span><span class="token punctuation">]</span>
<span class="token key property">authors</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">'Substrate DevHub &lt;https://github.com/substrate-developer-hub>'</span><span class="token punctuation">]</span>
<span class="token key property">description</span> <span class="token punctuation">=</span> <span class="token string">'FRAME pallet template'</span>
<span class="token key property">edition</span> <span class="token punctuation">=</span> <span class="token string">'2018'</span>
<span class="token key property">homepage</span> <span class="token punctuation">=</span> <span class="token string">'https://substrate.dev'</span>
<span class="token key property">license</span> <span class="token punctuation">=</span> <span class="token string">'Unlicensed'</span>
<span class="token key property">name</span> <span class="token punctuation">=</span> <span class="token string">'test-pallet'</span>
<span class="token key property">repository</span> <span class="token punctuation">=</span> <span class="token string">'https://github.com/substrate-developer-hub/substrate-pallet-template/'</span>
<span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">'3.0.0'</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="compile-the-template-pallet"></a><a href="#compile-the-template-pallet" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Compile the Template Pallet</h3>
<p>使用以下命令，您应该能够成功检查 Substrate 模板模板：</p>
<pre><code class="hljs css language-bash"><span class="hljs-built_in">cd</span> <span class="hljs-built_in">test</span>-pallet
SKIP_WASM_BUILD=1 cargo check
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="your-pallets-std-feature"></a><a href="#your-pallets-std-feature" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Your Pallet's <code>std</code> Feature</h3>
<p>在您的 <code>pallets/test-pallet/Cargo.toml</code> 文件中，您会看到一些关于&quot;<code>std</code>特性&quot;的代码。 在 Rust 中, 当您启用 <code>std</code>, 您可以让您的项目访问 <a href="https://doc.rust-lang.org/std/">Rust 标准库</a>。 在本地编译为二进制库时，这种方式没问题。</p>
<p>然而，Substrate 还会将 Runtime编译为 WebAssembly(Wasm)。 在这种情况下，我们使用 cargo 自带的功能来禁用 Rust 标准库。 因此，我们的模块以及整个 Runtime 使用的所有依赖， 都必须能够用<a href="https://rust-embedded.github.io/book/intro/no-std.html"><code>no_std</code></a> 编译。 如下所示，当某个模块使用 <code>std</code> 功能时，我们的 <code>Cargo.toml</code> 文件会告诉该模块只能使用他们自己的<code>std</code> 依赖：</p>
<p><strong><code>pallets/test-pallet/Cargo.toml</code></strong></p>
<pre><code class="hljs css language-TOML"><span class="hljs-section">[features]</span>
<span class="hljs-attr">default</span> = [<span class="hljs-string">'std'</span>]
<span class="hljs-attr">std</span> = [
    <span class="hljs-string">'codec/std'</span>,
    <span class="hljs-string">'frame-support/std'</span>,
    <span class="hljs-string">'frame-system/std'</span>,
]
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="consistent-substrate-dependencies"></a><a href="#consistent-substrate-dependencies" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Consistent Substrate Dependencies</h3>
<p>所有 Substrate 模块将依赖于一些底层的模块库，如 <code>frame-system</code> and <code>frame-support</code>。 这些库是从 crates.io 中拉取的。 当开发者基于模块构建自己的 Runtime 时，他们也会依赖于这些底层库。 您需要确保您的模块和 Runtime之间的依赖关系是一致的。</p>
<p><strong><code>pallets/test-pallet/Cargo.toml</code></strong></p>
<pre><code class="hljs css language-TOML"><span class="hljs-comment"># --snip--</span>
<span class="hljs-section">[dependencies]</span>
<span class="hljs-attr">frame-support</span> = { default-features = <span class="hljs-literal">false</span>, version = <span class="hljs-string">'3.0.0'</span> }
<span class="hljs-comment"># --snip--</span>
</code></pre>
<p>From the above snippet, we see that this pallet template depends on version <code>3.0.0</code> of the low-level libraries. Thus it can be used in runtimes that also depend on <code>3.0.0</code>.</p>
<blockquote>
<p>Note that substrate adheres to the <a href="https://semver.org/">semver</a> standards - thus each release is on the form <code>major.minor.patch</code>. In general it is <em>not</em> expected that major releases are compatible! Thus if you are developing a pallet, or integrating ones, be sure to match versions to keep things all working correctly.</p>
</blockquote>
<h3><a class="anchor" aria-hidden="true" id="your-pallets-dev-dependencies"></a><a href="#your-pallets-dev-dependencies" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Your Pallet's Dev Dependencies</h3>
<p><code>Cargo.toml</code> 文件的最后部分指定了开发环境依赖。 这些是在模块测试环境中需要的依赖，但不是实际发布需要模块的依赖。</p>
<p><strong><code>pallets/test-pallet/Cargo.toml</code></strong></p>
<pre><code class="hljs css language-TOML"><span class="hljs-comment"># --snip--</span>
<span class="hljs-section">[dev-dependencies]</span>
<span class="hljs-attr">sp-core</span> = { default-features = <span class="hljs-literal">false</span>, version = <span class="hljs-string">'3.0.0'</span> }
<span class="hljs-comment"># --snip--</span>
</code></pre>
<p>您可以使用如下命令，确认 Substrate 模块模板测试通过：</p>
<pre><code class="hljs css language-bash">SKIP_WASM_BUILD=1 cargo <span class="hljs-built_in">test</span>
</code></pre>
<p>当您在此模块中自定义逻辑时，您可能会在 <code>Cargo.toml</code> 文件中添加依赖。</p>
<h2><a class="anchor" aria-hidden="true" id="将模块添加到节点中"></a><a href="#将模块添加到节点中" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>将模块添加到节点中</h2>
<p>With our pallet now compiling and passing its tests, we're ready to add it to our node.</p>
<blockquote>
<p>If you aren't familiar with including and using other crates, refer to <a href="https://doc.rust-lang.org/cargo/guide/creating-a-new-project.html">the Cargo book</a> for an in-depth explanation.</p>
</blockquote>
<p>我们首先在节点 runtime 的 <code>Cargo.toml</code> 中添加我们新创建的 crate 依赖。 然后指定模块只有在 Runtime 构建时才构建 <code>std</code> ，如下所示：</p>
<p><strong><code>runtime/Cargo.toml</code></strong></p>
<pre><code class="hljs css language-TOML"><span class="hljs-comment"># --snip--</span>
<span class="hljs-attr">test-pallet</span> = { path = <span class="hljs-string">'../pallets/test-pallet'</span>, default-features = <span class="hljs-literal">false</span>, version = <span class="hljs-string">'3.0.0'</span> }

<span class="hljs-comment"># toward the bottom</span>
<span class="hljs-section">[features]</span>
<span class="hljs-attr">default</span> = [<span class="hljs-string">'std'</span>]
<span class="hljs-attr">std</span> = [
    <span class="hljs-string">'test-pallet/std'</span>,
    <span class="hljs-comment"># --snip--</span>
]
</code></pre>
<blockquote>
<p>You <strong>must</strong> set <code>default-features = false</code> so that your runtime will successfully compile to Wasm.</p>
</blockquote>
<p>Next we will update <code>runtime/src/lib.rs</code> to actually use our new runtime pallet, by adding a trait implementation with our <code>test_pallet</code> and add it in our <code>construct_runtime!</code> macro. Add the following code blocks:</p>
<p><strong><code>runtime/src/lib.rs</code></strong></p>
<pre><code class="hljs css language-rust"><span class="token comment">// add this line (or modify all of these to your named pallet </span>
<span class="token comment">// corresponding to `test-pallet` in its cargo.toml file)</span>
<span class="token keyword">pub</span> <span class="token keyword">use</span> test_pallet<span class="token punctuation">;</span>

<span class="token comment">// --snip--</span>

<span class="token comment">// add this block</span>
<span class="token keyword">impl</span> <span class="token namespace">test_pallet<span class="token punctuation">::</span></span><span class="token class-name">Config</span> <span class="token keyword">for</span> <span class="token class-name">Runtime</span> <span class="token punctuation">{</span>
  <span class="token keyword">type</span> <span class="token class-name">Event</span> <span class="token operator">=</span> <span class="token class-name">Event</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// --snip--</span>
<span class="token macro property">construct_runtime!</span><span class="token punctuation">(</span>
  <span class="token keyword">pub</span> <span class="token keyword">enum</span> <span class="token type-definition class-name">Runtime</span> <span class="token keyword">where</span>
    <span class="token class-name">Block</span> <span class="token operator">=</span> <span class="token class-name">Block</span><span class="token punctuation">,</span>
    <span class="token class-name">NodeBlock</span> <span class="token operator">=</span> <span class="token namespace">opaque<span class="token punctuation">::</span></span><span class="token class-name">Block</span><span class="token punctuation">,</span>
    <span class="token class-name">UncheckedExtrinsic</span> <span class="token operator">=</span> <span class="token class-name">UncheckedExtrinsic</span>
  <span class="token punctuation">{</span>
    <span class="token comment">// --snip--</span>
    <span class="token comment">// add the following line</span>
    <span class="token class-name">TestPallet</span><span class="token punctuation">:</span> <span class="token namespace">test_pallet<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Module</span><span class="token punctuation">,</span> <span class="token class-name">Call</span><span class="token punctuation">,</span> <span class="token class-name">Storage</span><span class="token punctuation">,</span> <span class="token class-name">Event</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="运行您的节点"></a><a href="#运行您的节点" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>运行您的节点</h2>
<p>At this point you have the pallet packaged up in its own crate and included in your node's runtime.</p>
<p>请确保您回到节点模板的根目录，然后编译节点，然后在开发模式中使用以下命令启动：</p>
<pre><code class="hljs css language-bash">cargo build --release
./target/release/node-template --tmp --dev
</code></pre>
<p>现在，启动 <a href="https://polkadot.js.org/apps/#/extrinsics?rpc=ws://127.0.0.1:9944">Polkadot-JS 应用程序将其连接到本地节点</a> 以确认模块正常运行。</p>
<blockquote>
<p><strong>Note:</strong> You can also manually set the node URL in Polkadot-JS Apps by navigating to the <strong>Settings</strong> tab, and have the <strong>remote node/endpoint to connect to</strong> set to <strong>Local Node</strong>.</p>
</blockquote>
<p>Congrats! You have created and integrated a new pallet inside its own crate for your node! If you want to see a solution to get to this step <a href="https://github.com/substrate-developer-hub/substrate-node-template/commit/eee6f630ad3305caa7d53819aae5db4a31ffe205">here is one to compare to</a> using FRAME v1 macros.</p>
<h2><a class="anchor" aria-hidden="true" id="发布您的模块"></a><a href="#发布您的模块" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>发布您的模块</h2>
<p>Once your pallet is no longer in test phase, you should consider publishing it to GitHub or crates.io.</p>
<h3><a class="anchor" aria-hidden="true" id="publishing-on-github"></a><a href="#publishing-on-github" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Publishing on GitHub</h3>
<p>To publish on GitHub, you need to <a href="https://help.github.com/en/articles/create-a-repo">create a GitHub repository</a> and <a href="https://help.github.com/en/articles/pushing-to-a-remote">push your pallet's code</a> to it.</p>
<h3><a class="anchor" aria-hidden="true" id="publishing-on-cratesio"></a><a href="#publishing-on-cratesio" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Publishing on Crates.io</h3>
<p>Crates.io allows permissionless publishing. Learn the procedure following their own guide about <a href="https://doc.rust-lang.org/cargo/reference/publishing.html">publishing on crates.io</a></p>
<h2><a class="anchor" aria-hidden="true" id="更新-runtime-的依赖"></a><a href="#更新-runtime-的依赖" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>更新 Runtime 的依赖</h2>
<p>With your pallet now published on GitHub, crates.io, or both, we can update your runtime to use the code that is published instead of a hard-coded file system path.</p>
<h3><a class="anchor" aria-hidden="true" id="dependencies-from-github"></a><a href="#dependencies-from-github" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Dependencies from GitHub</h3>
<p><strong><code>runtime/Cargo.toml</code></strong></p>
<pre><code class="hljs css language-TOML"><span class="hljs-section">[dependencies.your-pallet-name]</span>
<span class="hljs-attr">default_features</span> = <span class="hljs-literal">false</span>
<span class="hljs-attr">git</span> = <span class="hljs-string">'https://github.com/your-username/your-pallet'</span>
<span class="hljs-attr">branch</span> = <span class="hljs-string">'master'</span>

<span class="hljs-comment"># You may choose a specific commit or tag instead of branch</span>
<span class="hljs-comment"># rev = '&lt;git-commit&gt;'</span>
<span class="hljs-comment"># tag = '&lt;some tag&gt;</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="dependencies-from-cratesio"></a><a href="#dependencies-from-cratesio" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Dependencies from Crates.io</h3>
<p><strong><code>runtime/Cargo.toml</code></strong></p>
<pre><code class="hljs css language-TOML"><span class="hljs-section">[dependencies.your-pallet-name]</span>
<span class="hljs-attr">default_features</span> = <span class="hljs-literal">false</span>
<span class="hljs-attr">version</span> = <span class="hljs-string">'some-compatible-version'</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="最后一次构建"></a><a href="#最后一次构建" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>最后一次构建</h2>
<p>Compile one more time and notice that Cargo now grabs your pallet from GitHub or crates.io instead of using the local files.</p>
<h2><a class="anchor" aria-hidden="true" id="后续步骤"></a><a href="#后续步骤" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>后续步骤</h2>
<p>恭喜你！ You've written a Substrate pallet in its own Rust crate, and published it. Other blockchain developers can now easily use your pallet in their runtime by simply including those same four lines of code in their runtime's <code>Cargo.toml</code> files and updating their runtime's <code>lib.rs</code> file.</p>
<h3><a class="anchor" aria-hidden="true" id="进一步学习"></a><a href="#进一步学习" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>进一步学习</h3>
<ul>
<li>我们有很多展示 Substrate 开发概念和技术的 <a href="/tutorials">教程</a> 。</li>
<li>想要了解更多 Runtime 开发的技巧和模式等相关信息，请参阅我们的 <a href="https://substrate.dev/recipes/">Substrate Recipes</a>。</li>
<li>FRAME 模块中有 FRAME 中可使用的更多功能的超详细文档注释， 请查看 <a href="https://github.com/paritytech/substrate/tree/master/frame/example"><code>Substrate</code> 中的这个示例</a></li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="参考文档"></a><a href="#参考文档" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>参考文档</h3>
<ul>
<li><a href="https://doc.rust-lang.org/stable/cargo/">Cargo 大全</a></li>
<li>更多关于 <a href="https://rustwasm.github.io/">Rust 和 WebAssembly</a></li>
</ul>
</span></div></article></div><div class="docs-prevnext"></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#安装-node-template">安装 Node Template</a><ul class="toc-headings"><li><a href="#starting-with-the-pallet-template">Starting with the Pallet Template</a></li><li><a href="#option-1-use-this-template-from-github">Option 1: <code>Use This Template</code> from Github</a></li><li><a href="#option-2--clone-a-copy-of-the-template">Option 2:  Clone a copy of the Template</a></li></ul></li><li><a href="#substrate-模块模板">Substrate 模块模板</a><ul class="toc-headings"><li><a href="#renaming-your-crate">Renaming Your Crate</a></li><li><a href="#compile-the-template-pallet">Compile the Template Pallet</a></li><li><a href="#your-pallets-std-feature">Your Pallet's <code>std</code> Feature</a></li><li><a href="#consistent-substrate-dependencies">Consistent Substrate Dependencies</a></li><li><a href="#your-pallets-dev-dependencies">Your Pallet's Dev Dependencies</a></li></ul></li><li><a href="#将模块添加到节点中">将模块添加到节点中</a></li><li><a href="#运行您的节点">运行您的节点</a></li><li><a href="#发布您的模块">发布您的模块</a><ul class="toc-headings"><li><a href="#publishing-on-github">Publishing on GitHub</a></li><li><a href="#publishing-on-cratesio">Publishing on Crates.io</a></li></ul></li><li><a href="#更新-runtime-的依赖">更新 Runtime 的依赖</a><ul class="toc-headings"><li><a href="#dependencies-from-github">Dependencies from GitHub</a></li><li><a href="#dependencies-from-cratesio">Dependencies from Crates.io</a></li></ul></li><li><a href="#最后一次构建">最后一次构建</a></li><li><a href="#后续步骤">后续步骤</a><ul class="toc-headings"><li><a href="#进一步学习">进一步学习</a></li><li><a href="#参考文档">参考文档</a></li></ul></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/Substrate-logo.svg" alt="Substrate Developer Hub" width="66" height="58"/></a><div><h5>开发者中心</h5><a href="/zh-CN/tutorials">教程</a><a href="/docs/zh-CN/">知识库</a><a href="https://substrate.dev/recipes/">进阶菜谱</a><a href="https://substrate.dev/rustdocs">API 文档</a></div><div><h5>社区</h5><a href="/zh-CN/community">社区主页</a><a href="/zh-CN/newsletter">通讯</a><a href="https://app.element.io/#/room/!HzySYSaIhtyWrwiwEV:matrix.org">Substrate 技术聊天室</a><a href="/zh-CN/seminar">Substrate 研讨会</a><a href="http://stackoverflow.com/questions/tagged/substrate" target="_blank" rel="noreferrer noopener">Stack Overflow</a><a href="https://twitter.com/substrate_io" target="_blank" rel="noreferrer noopener">推特</a><a href="https://www.meetup.com/parity/" target="_blank" rel="noreferrer noopener">聚会活动</a></div><div><h5>更多</h5><a href="https://www.substrate.io/builders-program/">Substrate Builders 计划</a><a href="https://www.parity.io/blog/">Blog</a><a href="https://github.com/paritytech/substrate">Substrate GitHub</a><a href="https://github.com/substrate-developer-hub/">开发者中心 GitHub</a><a href="https://www.parity.io/privacy/">隐私政策</a><a href="/terms">使用条款</a><a href="#" id="cookie-settings">Cookie 设置<script>
                var cookieSettings = document.getElementById('cookie-settings');
                cookieSettings.onclick = function() {
                  return klaro.show();
                };
              </script></a></div></section><section class="copyright">Copyright © 2021 Parity Technologies</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '5cd09916f4ba4c283b2d45ee7386fc34',
                indexName: 'substrate',
                inputSelector: '#search_input_react',
                algoliaOptions: {"facetFilters":["language:zh-CN"]}
              });
            </script></body></html>